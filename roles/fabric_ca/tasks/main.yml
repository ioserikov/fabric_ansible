###  roles/fabric_ca/tasks/main.yml file


---
#hosts: fabric_ca_host 

- name: build fabric_ca_server binary
  shell: "{{ item }}"
  args:
    chdir: "{{ fabric_ca_src_dir }}"
  with_items:    
    - go get  github.com/hyperledger/fabric-ca
    - make fabric-ca-server
    - cp {{ fabric_ca_src_dir }}bin/fabric-ca-server {{ fabric_ca_dir }}
  become: no
  ignore_errors: True
  environment:
    PATH: /sbin:/usr/sbin:/bin:/usr/bin:/usr/local/bin:/usr/local/go/bin
    GOPATH: /home/laborant/go
    GOMOD: /home/laborant/fabric/go.mod
    GOROOT: /usr/local/go  


- name: build fabric_ca_client binary
  shell: "{{ item }}"
  args:
    chdir: "{{ fabric_ca_src_dir }}"
  with_items:    
    - go get  github.com/hyperledger/fabric-ca
    - make fabric-ca-client
    - cp {{ fabric_ca_src_dir }}bin/fabric-ca-client {{ fabric_ca_dir }}
  become: no
  ignore_errors: True
  environment:
    PATH: /sbin:/usr/sbin:/bin:/usr/bin:/usr/local/bin:/usr/local/go/bin
    GOPATH: /home/laborant/go
    GOMOD: /home/laborant/fabric/go.mod
    GOROOT: /usr/local/go

- name: translate fabric-ca config file to run
  template:
      dest: "{{ fabric_ca_dir }}fabric-ca-server-config.yaml"
      src: "files/fabric-ca-server-config.yaml.j2"
      force: yes 
      unsafe_writes: no 
      backup: yes  
  register: fabric_ca_config_file


#- name: run fabric-ca server
#  shell:




